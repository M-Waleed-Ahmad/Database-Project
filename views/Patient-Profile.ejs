<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width= , initial-scale=1.0">
    <link rel="stylesheet" href="../css/Patient-Profile.css">
    <link rel="stylesheet" href="../css/Components.css">
    <link rel="shortcut icon" href="../images/logo.jpg" type="image/x-icon">
    <title>Patient Page</title>
</head>
<body style="background-color: #b9d6eb;">
    <nav class="outernav">
        <nav class="innernav1">
            <div style="grid-area: 1/1;">
                 <div class="sidebar" id="sidebar">
                     <ul>
                         <li><a href="#">Logout</a></li>
                         <li><a href="#">Setting</a></li>
                         <li><a class="item" id="link1"  data-section="1" href="#" onclick="toggleSection(document.getElementById('link1'));">Profile</a></li>
                    </ul>
                 </div>
                
                 <div class="hamburger" id="hamburger">
                     <div class="bar"></div>
                     <div class="bar"></div>
                     <div class="bar"></div>
                 </div>
             </div>
           
                 <img src="../images/profile-default.svg" alt="">
                 <ul>
                     <li><a class="as" href="/home">Home</a></li>
                     <li><a class="as" href="/services">Services</a></li>
                     <li><a class="as" href="/contact">Contact Us</a></li>
                     <li><a class="as" href="doctors">Doctors</a></li>
                 </ul>
                 <div class="search-icon">
                    <input type="text" id="search-box" placeholder="Search">
                    <button type="submit" id="search-button"><i class="fa fa-search">ss</i></button>
                </div>
        </nav>
        <nav class="innernav2">
            <ul>
                <li><a class="item" id="link2" href="#"  data-section="2"  onclick="toggleSection(document.getElementById('link2'));toggleLine(this)">Appointments</a></li>
                <li><a class="item" id="link3" href="#"  data-section="3" onclick="toggleSection(document.getElementById('link3'));toggleLine(this)">Consultations</a></li>
                <li><a class="item" id="link4" href="#"  data-section="4" onclick="toggleSection(document.getElementById('link4'));toggleLine(this)">Prescriptions</a></li>
                <li><a class="item" id="link5" href="#"  data-section="5" onclick="toggleSection(document.getElementById('link5'));toggleLine(this)">Support Community</a></li>
            </ul>
            <div class="line"></div>
        </nav>
        
    </nav>
    <section id="sidebar" class="sidebar">
        <ul>
            <li><a href="#">Link 1</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Settings </a></li>
        </ul>
    </section>
     <section class="container" id="div-section">
        <div id="div1"></div>
        <div id="div2"></div>
        <div id="div3"></div>
        <div id="div4"></div>
        <div id="div5"></div>
    </section>


    <script>
 // Event listener to toggle the sidebar
    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburger');

    hamburger.addEventListener('click', () => {
        sidebar.style.left = sidebar.style.left === '0px' ? '-250px' : '0px';
    });

    // Function to toggle section and update URL without reloading the page
    function toggleSection(element) {
        const section = element.getAttribute('data-section'); // Get the section number 
        const url = '/patient?section=' + section;
        window.history.pushState({}, '', url); // Update URL without reloading the page
    }

    // Function to fetch data for the selected section using AJAX
    function fetchData(section) {
        // AJAX request
        const xhr = new XMLHttpRequest();
        xhr.open('GET', '/patient' + section, true);

        // Set up onload handler
        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 400) {
                // On successful response, update the content of the section
                const responseData = JSON.parse(xhr.responseText);
                updateSectionContent(section, responseData);
                console.log(responseData);
            } else {
                console.error('Request failed with status:', xhr.status);
            }
        };

        // Set up onerror handler
        xhr.onerror = function() {
            console.error('Request failed');
        };

        // Send the request
        xhr.send();
    }

    // Function to update the content of the section based on the fetched data
    function updateSectionContent(section, data) {
        const sectionElement = document.getElementById(`div${section}`);
    
        switch (section) {
            case '1':
            for (let int = 2; int < 5; int++) {
                document.getElementById(`div${int}`).style.display = 'none';
            }
            sectionElement.style.display = 'block';
            sectionElement.innerHTML=`
                <div id="div1" class="div1">
                <div  class="profile">
                    <!-- Profile Image -->
                    <div class="sect-1">
                        <div style="display: flex;justify-content: center;">
                            <img src="../images/profile-default.svg" alt="Profile Picture">
                        </div>
                        <!-- Basic and Emergency Information -->
                        <div class="info">
                        
                            <p><strong>Name:</strong>  ${data.Patient[0].FirstName}</p>
                            <p><strong>Blood Type:</strong> O+</p>
                            <p><strong>Allergies:</strong>${data.Patient[0].Allergies} </p>
                            <p><strong>Medical Conditions:</strong>${data.Patient[0].Disease}</p>
                            <p><strong>Emergency Contact:</strong> ${data.Patient[0].Contactname}</p>
                        </div>
                    </div>
             
                          <!-- Current and Past Health Records (On the Right Side) -->
                    <div id="rec" class="sect-2 records" >
                        <br>
                    </div>
                </div>
            </div>        
            `;
            const sec = document.getElementById(`rec`);
            n=data.Patient.length;
            for (let int = 0; int < n; int++) {
                sec.innerHTML += `
                <p>
                    <strong>Medical History:</strong>  ${data.Patient[int].FirstName}
                    <strong>Treatment:</strong>  ${data.Patient[int].FirstName}
                    <strong>Status:</strong>  ${data.Patient[int].FirstName}
                </p>           
            `;
            }
            console.log(data);
    
            break;
            case '2':
                sectionElement.style.display = 'block';
                for (let int = 1; int <= 5; int++) {
                    if (int==2) {
                    continue;   
                    }
                    document.getElementById(`div${int}`).style.display = 'none';

                }

                sectionElement.innerHTML=`
                <button class="btn">Create Appointments</button>
      
                <div class="appoint">
                        <div class="Appointments-1">

                        </div>
                        <div class="appointments-2">
                        </div>
                </div>
            </div>
                `;
                console.log(data); 
                const appointments1Section = document.querySelector('.Appointments-1');
                n=data.Appointments.length;
                console.log(n);
                for (let int = 0; int < n; int++) {
                    appointments1Section.innerHTML += `
                    <div class="doc" id="doc${int}" onclick="displayData('doc${int}')">
                        <p><strong>Patient Name:</strong> ${data.Appointments[int].PatientFirstName}</p>
                        <p><strong>Doctor Name:</strong> ${data.Appointments[int].DoctorLastName}</p>
                        <p><strong>Case:</strong> ${data.Appointments[int].CaseDescription}</p>
                        <p><strong>Date:</strong> ${data.Appointments[int].AppointmentDateTime}</p>
                    </div>
                        `;

                }
            break;
            case '3':
            sectionElement.style.display = 'block';
                for (let int = 1; int <= 5; int++) {
                    if (int==3) {
                    continue;   
                    }
                    document.getElementById(`div${int}`).style.display = 'none';

                }
                console.log('ada');
                sectionElement.innerHTML=`
                <header>
                <h1>Consultations</h1>
                 </header>
                <main>
                    <div  class="chat">
                        <h2>Your Chats</h2>
                        <div id="chats" class="chat-list">
                            <!-- Chat previews will be dynamically added here -->
                        </div>
                    </div>
                    <div id="conversation" >
                        <h2>Conversation</h2>
                        <div class="conversation">
                            <!-- Conversation messages will be dynamically added here -->
                        </div>
                    </div>
                </main> 
                `
                chat=document.getElementById('chats');
                console.log('chats  ',chat)
                n=data.Messages.length;
                for (let index = 0; index < n; index++) {
                    chat.innerHTML+=`
                    <div class="chat-box">
                        <p>Doctor: ${data.Messages[index].OtherPersonFirstName+data.Messages[index].OtherPersonLastName}</p>
                        </div>
                        `                    
                }
                console.log('chats  ',chat)
            
                break;
            case '4':
                // Update Prescriptions section with data
                break;
            case '5':
                // Update Support Community section with data
                break;
            default:
                // Handle invalid section
                break;
        }
    }

    // Function to handle clicking on section links
    function handleSectionClick(element) {
        const section = element.getAttribute('data-section'); // Get the section number from data attribute
        toggleSection(element); // Toggle section without reloading the page
        fetchData(section); // Fetch data for the selected section
    }

    // Function to initialize the page
    function initializePage() {
        // Add event listeners to section links
        const sectionLinks = document.querySelectorAll('.item');
        sectionLinks.forEach(link => {
            link.addEventListener('click', () => {
                handleSectionClick(link);
            });
        });
    }

    // Call initializePage() function when the page is fully loaded
    window.addEventListener('load', initializePage);


        function toggleLine(element) {
            const line = document.querySelector('.line');
            const navItems = document.querySelectorAll('.item');
            
            const itemWidth = element.offsetWidth;
            const itemOffsetLeft = element.offsetLeft;
            const containerOffsetLeft = document.querySelector('.innernav2').offsetLeft; 
            line.style.width = itemWidth + 'px';
            line.style.transform = 'translateX(' + (itemOffsetLeft - containerOffsetLeft) + 'px)'; 
            
            navItems.forEach(item => {
                item.classList.remove('active');
            });

            element.classList.add('active');
        }
 
        const appointmentsSection = document.querySelector('.appointments-2');
        console.log(appointmentsSection);
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const appointmentsRect = appointmentsSection.getBoundingClientRect();
            const originalTop = 20; // Original top position of appointments-2 section

            if (scrollTop > originalTop) {
                // Scrolling down
                appointmentsSection.style.position = 'fixed';
                appointmentsSection.style.top = '10%'; // Adjust as needed
            } else {
                // Scrolling up or at the top
                appointmentsSection.style.position = 'sticky';
            }
        });

        function displayData(docId) {
        const docElement = document.getElementById(docId);

        const name = docElement.querySelector('p:nth-child(1)').innerText;
        const caseInfo = docElement.querySelector('p:nth-child(2)').innerText;
        const date = docElement.querySelector('p:nth-child(3)').innerText;
 
        // Display the data in the appointments-2 section
        const appointments2Section = document.querySelector('.appointments-2');
        appointments2Section.innerHTML = `
        <h2>Appointment Details</h2>
        <p><strong>Name:</strong> ${name}</p>
        <p><strong>Case:</strong> ${caseInfo}</p>
        <p><strong>Date:</strong> ${date}</p>
        <p><strong>Doctor:</strong> Shaka</p>
        <p><strong>Location:</strong> Shaka</p>
        <p><strong>Time:</strong> Shaka</p>
        <div style="margin-left:40px;">
            <button class="btn1" ">Cancel</button>
            <button class="btn1" ">Confirm</button>
            <button class="btn1" ">Text</button>
            <button class="btn1" ">Set Reminder</button>        
        </div>`;

    }


    </script>
</body>
</html>